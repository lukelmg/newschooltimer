<html>

<body onload="read();">
  Timer
  <br />
  <p id="output"></p>
  <p id="time"></p>
  <p id="time0"></p>
  <p id="time1"></p>
  <p id="time2"></p>
  <p id="time3"></p>
  <p id="time4"></p>
  <p id="time5"></p>
  <p id="time6"></p>
  <p id="time7"></p>
  <p id="time8"></p>
  <p id="time9"></p>
  <p id="time10"></p>
  <p id="time11"></p>
  <p id="time12"></p>
  <p id="time13"></p>
  <p id="time14"></p>
  <p id="time15"></p>
  <div id="timerContainer"></div>

  <div id="timerContainer2"></div>

  <form id="selectorDiv"></form>
  <br><br><br>
  <p id="result">test</p>
</body>

</html>

<style>
  body {
    font-size: 2vh;
  }
</style>


<script>


  var numberOfSchedules;
  var scheduleNames;
  var scheduleAbbreviations;
  var periodsPerSchedule;
  var periodTimes;

  var periodScheduleArray = [];
  var nameArray = [];
  var timeArray = [];

  var scheduleSplit = [];


  var scheduleAbbreviationsArray = [];

  function read() {

    var url_string = window.location.href;
    var url = new URL(url_string);

    numberOfSchedules = url.searchParams.get("nums");
    scheduleNames = url.searchParams.get("names");
    periodTimes = url.searchParams.get("times");
    scheduleAbbreviations = url.searchParams.get("abbs");
    periodsPerSchedule = url.searchParams.get("pers");

    document.getElementById("output").innerHTML = "# of Schedules:" + numberOfSchedules + "<br> Schedule Names: " + scheduleNames + "<br> Schedule Times: " + periodTimes +
      "<br> Schedule Abbrevaitions: " + scheduleAbbreviations + "<br> Periods per schedule: " + periodsPerSchedule;

    scheduleAbbreviationsArray = scheduleAbbreviations.split(",");

    periodScheduleArray = periodsPerSchedule.split(",");

    nameArray = scheduleNames.split(",");

    timeArray = periodTimes.split(",");


    //Made radio buttons
    var container = document.getElementById("selectorDiv");

    while (container.hasChildNodes()) {
      container.removeChild(container.lastChild);
    }


    for (var i = 0; i < (numberOfSchedules); i++) {
      var rad = document.createElement("input");
      if (i == 0) {
        rad.checked = true;
      }
      rad.type = "radio";
      rad.name = "schedulesRadioName";
      rad.id = i + "scheduleCheckRadio";
      rad.oninput = function() {
        radioButtonDetection(this.id);
      };
      var para = document.createElement("span");
      var node = document.createTextNode(scheduleAbbreviationsArray[i]);
      para.appendChild(node);
      container.appendChild(para);
      container.appendChild(rad);
    }
    // end of make radios buttons



    // make time and name in chunks
    var k = 0;
    var p, j, timeSplitArray, nameSplitArray, chunk;
    for (p = 0, j = timeArray.length; p < j; p += chunk) {

      var prtest = parseInt(periodScheduleArray[k]);
      p, j, timeSplitArray, nameSplitArray, chunk = prtest;
      timeSplitArray = timeArray.slice(p, p + chunk);
      nameSplitArray = nameArray.slice(p, p + chunk);

      scheduleSplit[k] = timeSplitArray + "#" + nameSplitArray + "|||";

      k++;
    }
    getSchedulesReadyForTimer();
  }

  var which;

  var currentScheduleSelected = 0;

  function radioButtonDetection(which) {
    var ele = document.getElementsByName('schedulesRadioName');

    for (i = 0; i < ele.length; i++) {
      if (ele[i].checked)
        document.getElementById("result").innerHTML = which;
      currentScheduleSelected = which.charAt(0);
    }
    getSchedulesReadyForTimer();
  }

  var newTest = [];

  function getSchedulesReadyForTimer() {
    for (var i = 0; i < numberOfSchedules; i++) {
      newTest[i] = scheduleSplit[i].split("|||");
    }
  //   alert(newTest[currentScheduleSelected]);

    addTimersPerSchedule();
  }


  var timerContainer = document.getElementById("timerContainer");

  function addTimersPerSchedule() {
    while (timerContainer.hasChildNodes()) {
      timerContainer.removeChild(timerContainer.lastChild);
    }

    for (var i = 0; i < periodScheduleArray[currentScheduleSelected]; i++) {

      var para = document.createElement("p");
      var node = document.createTextNode("Period" + (i + 1));
      var timer = document.createElement("SPAN")
      para.appendChild(node);
      timerContainer.appendChild(para);
    }
    setUpTimesForTimers();
  }

var timeForMathArray = [];
var newTimeForMathArray = [];
var hourArray = [];
var minuteArray = [];

  function setUpTimesForTimers() {
    hourArray = [];
    minuteArray = [];
    timeForMathArray = [];
    newTimeForMathArray = [];
   var split1 = newTest[currentScheduleSelected];
   var split2 = String(split1);
   split2 = split2.split('#')[0]

  timeForMathArray = split2.split(":");
  timeForMathArray = String(timeForMathArray);
  newTimeForMathArray = timeForMathArray.split(",");

   var k = 0;
   for (var i = 0; i <  periodScheduleArray[currentScheduleSelected]; i++) {
     hourArray[i] = newTimeForMathArray[k];
     minuteArray[i] = newTimeForMathArray[(k+1)];
     k = k + 2;
   }

   alert(hourArray);
   alert(minuteArray);

  }

  (function() {
    var start = new Date;

    function pad(num) {
      return ("0" + parseInt(num)).substr(-2);
    }

    function tick() {
      var now = new Date;

      for (var i = 0; i < periodScheduleArray[currentScheduleSelected]; i++) {

        start.setHours(hourArray[i], minuteArray[i], 0); // 11pm

        if (now > start) { // too late, go to tomorrow
          start.setDate(start.getDate() + 1);
        }
        var remain = ((start - now) / 1000);
        var hh = pad((remain / 60 / 60) % 60);
        var mm = pad((remain / 60) % 60);
        var ss = pad(remain % 60);
        document.getElementById('time' + i).innerHTML = hh + ":" + mm + ":" + ss;
      }
      setTimeout(tick, 0);
    }

    document.addEventListener('DOMContentLoaded', tick);
  })();
</script>
