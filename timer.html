<html>

<body onload="read();">
  Timer
  <br />
  <p id="output"></p>
  <p id="time"></p>
<div id="timerContainer"></div>

              <form id="selectorDiv"></form>
<br><br><br>
              <p id="result">test</p>
</body>

</html>

<style>
  body {
    font-size: 2vh;
  }
</style>


<script>
  var numberOfSchedules;
  var scheduleNames;
  var scheduleAbbreviations;
  var periodsPerSchedule;
  var periodTimes;

var periodScheduleArray = [];
var nameArray = [];
var timeArray = [];

var scheduleSplit = [];


var scheduleAbbreviationsArray = [];
  function read() {

    var url_string = window.location.href;
    var url = new URL(url_string);

    numberOfSchedules = url.searchParams.get("nums");
    scheduleNames = url.searchParams.get("names");
    periodTimes = url.searchParams.get("times");
    scheduleAbbreviations = url.searchParams.get("abbs");
    periodsPerSchedule = url.searchParams.get("pers");

    document.getElementById("output").innerHTML = "# of Schedules:" + numberOfSchedules + "<br> Schedule Names: " + scheduleNames + "<br> Schedule Times: " + periodTimes +
      "<br> Schedule Abbrevaitions: " + scheduleAbbreviations + "<br> Periods per schedule: " + periodsPerSchedule;

      scheduleAbbreviationsArray = scheduleAbbreviations.split(",");

    periodScheduleArray = periodsPerSchedule.split(",");

    nameArray = scheduleNames.split(",");

    timeArray = periodTimes.split(",");


//Made radio buttons
    var container = document.getElementById("selectorDiv");

    while (container.hasChildNodes()) {
      container.removeChild(container.lastChild);
    }


    for (var i = 0; i <  (numberOfSchedules); i++) {
      var rad = document.createElement("input");
      if (i == 0) {
        rad.checked = true;
      }
      rad.type = "radio";
      rad.name = "schedulesRadioName";
      rad.id = i + "scheduleCheckRadio";
      rad.oninput = function() {
        radioButtonDetection(this.id);
      };
      var para = document.createElement("span");
      var node = document.createTextNode(scheduleAbbreviationsArray[i]);
      para.appendChild(node);
      container.appendChild(para);
      container.appendChild(rad);
    }
// end of make radios buttons



// make time and name in chunks
              var k = 0;
              var p,j,timeSplitArray,nameSplitArray,chunk;
                for (p=0,j=timeArray.length; p<j; p+=chunk) {

                    var prtest = parseInt(periodScheduleArray[k]);
                    p,j,timeSplitArray,nameSplitArray,chunk = prtest;
                    timeSplitArray = timeArray.slice(p,p+chunk);
                    nameSplitArray = nameArray.slice(p,p+chunk);

                    scheduleSplit[k] = timeSplitArray + nameSplitArray + "|||";

                    k++;
                }
addTimersPerSchedule();
  }

var which;

var currentScheduleSelected = 0;

function radioButtonDetection (which) {
  var ele = document.getElementsByName('schedulesRadioName');

            for(i = 0; i < ele.length; i++) {
                if(ele[i].checked)
                document.getElementById("result").innerHTML = which;
                currentScheduleSelected = which.charAt(0);
            }
            getSchedulesReadyForTimer();
}

var newTest = [];

var testSplit = "hello|||time|||what|||time|||is|||it";

function getSchedulesReadyForTimer() {
  for (var i = 0; i < numberOfSchedules; i++) {
    newTest[i] = scheduleSplit[i].split("|||");
  }
//  alert(newTest[currentScheduleSelected]);
  addTimersPerSchedule();
}



function addTimersPerSchedule () {
  var container = document.getElementById("timerContainer");
  while (container.hasChildNodes()) {
    container.removeChild(container.lastChild);
  }

for (var i = 0; i < periodScheduleArray[currentScheduleSelected]; i++) {

  var para = document.createElement("p");
  var node = document.createTextNode("Period" + (i+1));
  para.appendChild(node);
  container.appendChild(para);
}
}



/*
var hourTest = ["17", "18", "19", "20", "21", "22", "23"];
var minTest = ["0", "10", "20", "30", "40", "50", "59"];


  (function() {

  function pad(num) {
    return ("0" + parseInt(num)).substr(-2);
  }

  function tick() {
    for (var i = 0; i < periodScheduleArray[0]; i++) {
      var start = new Date;
      start.setHours(hourTest[i], minTest[i], 0);
      var now = new Date;
      if (now > start) { // too late, go to tomorrow
        start.setDate(start.getDate() + 1);
      }
      var remain = ((start - now) / 1000);
      var hh = pad((remain / 60 / 60) % 60);
      var mm = pad((remain / 60) % 60);
      var ss = pad(remain % 60);
      document.getElementById('time' + i).innerHTML =  hh + ":" + mm + ":" + ss;
    }
    setTimeout(tick, 500);
  }

  document.addEventListener('DOMContentLoaded', tick);
})();
*/

(function() {
  var start = new Date;
  start.setHours(23, 0, 0); // 11pm

  function pad(num) {
    return ("0" + parseInt(num)).substr(-2);
  }

  function tick() {
    for (var i = 0; i < periodScheduleArray[0]; i++) {
      var start = new Date;
      start.setHours(hourTest[i], minTest[i], 0);
      var now = new Date;
      if (now > start) { // too late, go to tomorrow
        start.setDate(start.getDate() + 1);
      }
      var remain = ((start - now) / 1000);
      var hh = pad((remain / 60 / 60) % 60);
      var mm = pad((remain / 60) % 60);
      var ss = pad(remain % 60);
      document.getElementById('time' + i).innerHTML =  hh + ":" + mm + ":" + ss;
    }
    setTimeout(tick, 500);
  }

  document.addEventListener('DOMContentLoaded', tick);
})();
</script>
